import{_ as e,c as i,a0 as a,o as n}from"./chunks/framework.p2VkXzrt.js";const k=JSON.parse('{"title":"Middleware in S-PHP","description":"","frontmatter":{},"headers":[],"relativePath":"advanced/custom-middleware.md","filePath":"advanced/custom-middleware.md"}'),t={name:"advanced/custom-middleware.md"};function l(r,s,h,d,o,p){return n(),i("div",null,s[0]||(s[0]=[a(`<h1 id="middleware-in-s-php" tabindex="-1">Middleware in S-PHP <a class="header-anchor" href="#middleware-in-s-php" aria-label="Permalink to &quot;Middleware in S-PHP&quot;">​</a></h1><p>Middleware in S-PHP provides a convenient mechanism for filtering HTTP requests entering your application. Middleware functions as an intermediary between the request and the controller, allowing you to perform tasks such as authentication, logging, or validation before the request reaches the actual controller logic.</p><h2 id="what-is-middleware" tabindex="-1">What is Middleware? <a class="header-anchor" href="#what-is-middleware" aria-label="Permalink to &quot;What is Middleware?&quot;">​</a></h2><p>Middleware is a class that handles HTTP requests before they reach the controller. It acts as a filter, intercepting requests to verify certain conditions are met (e.g., user authentication, access control), and either allowing the request to proceed or halting it with an appropriate response.</p><h2 id="creating-middleware" tabindex="-1">Creating Middleware <a class="header-anchor" href="#creating-middleware" aria-label="Permalink to &quot;Creating Middleware&quot;">​</a></h2><p>In S-PHP, middleware is typically stored in the <code>app/middleware</code> directory. Here&#39;s how a simple <code>Middleware</code> class is defined:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> App\\Middleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> App\\Core\\Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// PHP cannot support multiple class inheritance, so we use namespaces</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Middleware</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Handle the request, checking if the user is authenticated</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">auth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Authentication check</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> auth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Check if user session is available</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$_SESSION[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="key-components" tabindex="-1">Key Components: <a class="header-anchor" href="#key-components" aria-label="Permalink to &quot;Key Components:&quot;">​</a></h2><ul><li><code>handle():</code> The main method that will be called to handle the incoming request. If the authentication check fails, it returns false, effectively blocking the request.</li><li><code>auth():</code> A helper method that checks if the session contains a valid user.</li></ul><blockquote><p>If the session does not have a user, the request is denied.In this example, the middleware is used to check if the user is authenticated before allowing access to certain routes. If the user is not authenticated (i.e., no $_SESSION[&#39;user&#39;]), the middleware returns false, which can prevent further processing.</p></blockquote><h3 id="using-middleware-in-routes" tabindex="-1">Using Middleware in Routes <a class="header-anchor" href="#using-middleware-in-routes" aria-label="Permalink to &quot;Using Middleware in Routes&quot;">​</a></h3><p>Once you have created your middleware, you can apply it to specific routes to protect them from unauthorized access.</p><p>In your routes.php or equivalent file, you can specify which middleware should be applied to specific routes. For example:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$router</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/home&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">HomeController</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;index&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Middleware</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This line will call the handle() method of the Middleware class when a request is made to the /home route. If the auth() method in Middleware returns false, the request will be blocked, and the user will be denied access.</span></span></code></pre></div><br><hr><br><h1 id="benefits-of-middleware" tabindex="-1">Benefits of Middleware <a class="header-anchor" href="#benefits-of-middleware" aria-label="Permalink to &quot;Benefits of Middleware&quot;">​</a></h1><h3 id="middleware-offers-several-advantages" tabindex="-1">Middleware offers several advantages: <a class="header-anchor" href="#middleware-offers-several-advantages" aria-label="Permalink to &quot;Middleware offers several advantages:&quot;">​</a></h3><ul><li><code>Separation of concerns:</code> It allows you to separate the logic for authentication, logging, and other tasks from the controller.</li><li><code>Reusability:</code> Middleware can be reused across multiple routes or controllers, making your code more modular and easier to maintain. Control over request flow: Middleware gives you more control over the flow of requests in your application, allowing you to stop or modify the request before it reaches the controller.</li></ul><h3 id="example-use-cases-for-middleware" tabindex="-1">Example Use Cases for Middleware <a class="header-anchor" href="#example-use-cases-for-middleware" aria-label="Permalink to &quot;Example Use Cases for Middleware&quot;">​</a></h3><ul><li><code>Authentication:</code> Check if a user is logged in before they can access certain pages or resources.</li><li><code>Authorization:</code> Verify if the logged-in user has permission to access the requested resource.</li><li><code>Logging:</code> Log the details of requests made to certain routes for auditing purposes.</li><li><code>Input Validation:</code> Validate request data before processing it in the controller.</li></ul><h3 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to &quot;Conclusion&quot;">​</a></h3><p>Middleware in S-PHP provides a powerful and flexible way to filter HTTP requests and ensure that certain conditions are met before a request is passed to the controller. By using middleware, you can centralize common functionality like authentication and authorization, leading to cleaner and more maintainable code.</p><p>For advanced middleware functionality, you can create custom methods and chain multiple middleware classes together to perform complex request processing.</p>`,25)]))}const u=e(t,[["render",l]]);export{k as __pageData,u as default};
